function[ par ] = updateS( D, par, priors, info )

expect = getExpectations( par );

for i = 1:info.nclus

    % calculate the row of the precision for this cluster
    temp1 = zeros(info.nclus);
    for tsum = 2:(info.Tmax+1)
      temp1 = temp1 + expect.SIG(i,i) ...
	  * ( par.Fmean(:,tsum-1) * par.Fmean(:,tsum-1)' ... 
	     + pinv(par.Fprec{tsum-1}) );
    end
    par.Sprec{i} = priors.Sprec{i} + temp1;

    if( sum(diag(par.Sprec{i})<0)>0 )
      i
      expect.SIG
      sum(expect.SIG<0)
      par.Sprec{i}
      %par.Fprec
      error('diag(par.Sprec{i}) has a negative element')
    end
    
    % calculate the mean for this cluster
    temp2 = repmat(0,info.Tmax+1,info.nclus);
    for tsum = 2:(info.Tmax+1)
      temp2(tsum,:) = (par.Fmean(i,tsum)-par.Sconstmean(i)) ...
	  * expect.SIG(i,i) * par.Fmean(:,tsum-1)';
    end
    sum2 = sum(temp2,1);

     par.Smean(i,:) =  ( priors.Smean(i,:)*priors.Sprec{i} + sum2 ) ...
	 / par.Sprec{i} ;
    
end

par = updateSconst( D, par, priors, info );

end